<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>数字图像处理 - 南阳向北</title>
  
    <meta name="keywords" content="DIP">
  
  
    <meta name="description" content="数字图像处理基础理论（待补充）
(通俗易懂的计算机视觉优质课程)北京邮电大学计算机学院-鲁鹏
（文中所有图片均摘自该课程）">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  
  <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/favicon/favicon.ico">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
          
            南阳向北 <b><sup style='color:#3AA757'></sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fa fa-home fa-fw'></i>
                  
                  首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  
                    <i class='fas fa-link fa-fw'></i>
                  
                  友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  
                    <i class='fas fa-info-circle fa-fw'></i>
                  
                  关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="搜索" />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fa fa-home fa-fw'></i>
                  
                  首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  
                    <i class='fas fa-link fa-fw'></i>
                  
                  友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  
                    <i class='fas fa-info-circle fa-fw'></i>
                  
                  关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>




  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box blur article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2022/07/17/digital_image_process/">
        数字图像处理
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
<div class='new-meta-item author'>
  <a href="https://hbroad.github.io/" rel="nofollow">
    <img src="https://s2.loli.net/2022/08/22/P8GFieU49zC3jRl.jpg">
    <p>南阳向北</p>
  </a>
</div>

          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2022年7月17日</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
          
            
  
    <div class="new-meta-item browse valine">
      <a class='notlink'>
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id="/2022/07/17/digital_image_process/" class="leancloud_visitors" data-flag-title="数字图像处理">
        <p>
          <span class="leancloud-visitors-count">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
        </span>
      </a>
    </div>
  


          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>数字图像处理基础理论（待补充）</p>
<p><a href="https://cv-xueba.club/" target="_blank" rel="noopener">(通俗易懂的计算机视觉优质课程)北京邮电大学计算机学院-鲁鹏</a></p>
<p>（文中所有图片均摘自该课程）</p>
<a id="more"></a>

<h1 id="图像去噪（滤波）"><a href="#图像去噪（滤波）" class="headerlink" title="图像去噪（滤波）"></a>图像去噪（滤波）</h1><h2 id="常见噪声"><a href="#常见噪声" class="headerlink" title="常见噪声"></a>常见噪声</h2><img src="https://s2.loli.net/2022/08/24/4JRciqsQVUoTEfL.png" alt="image-20220824111547568" style="zoom:67%;" />

<h2 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h2><ul>
<li><p>卷积：把相关运算的<code>核旋转180°</code></p>
<ul>
<li>线性：$$F(f1+f2) = F(f1)+F(f2)$$</li>
<li>平移不变形：$$F(S(f)) = S(F(f))$$</li>
<li>满足线性平移不变性的操作均可定义为卷积</li>
<li>满足交换律、结合律、分配律</li>
</ul>
</li>
<li><p>卷积时边缘的处理：边界填充</p>
<ul>
<li>卷积核的特性导致卷积后的图像和原图不一样大</li>
<li>零填充（常用）</li>
<li>复制边缘</li>
<li>镜像边缘</li>
</ul>
</li>
<li><p>常见核</p>
<ul>
<li><p>单位脉冲核</p>
</li>
<li><p>平移核</p>
</li>
<li><p>平滑核</p>
</li>
<li><p>锐化操作</p>
</li>
</ul>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/EbCjmkBXQRn7Z8o.png" alt="图像" style="zoom:67%;" />

<h2 id="高斯卷积"><a href="#高斯卷积" class="headerlink" title="高斯卷积"></a>高斯卷积</h2><ul>
<li><p>平均卷积核的问题</p>
<ul>
<li><p>中心与邻域的权重一致，导致振铃现象（卷积后图像出现的条状）</p>
</li>
<li><p>解决：根据邻域像素与中心的远近程度分配权重，离中心越近，权重越大</p>
</li>
</ul>
</li>
</ul>
<h3 id="高斯卷积的生成"><a href="#高斯卷积的生成" class="headerlink" title="高斯卷积的生成"></a>高斯卷积的生成</h3><img src="https://s2.loli.net/2022/08/24/9AaKPzItFvZGfxM.png" alt="image-20220824104058744" style="zoom:67%;" />

<p>​        <code>归一化即为 3 中各个位置权重值/总的权重值</code></p>
<h3 id="参数的选取"><a href="#参数的选取" class="headerlink" title="参数的选取"></a>参数的选取</h3><ul>
<li>大标准差或者大尺寸卷积核平滑能力强</li>
<li>小标准差或者小尺寸卷积核平滑能力弱</li>
</ul>
<p>解释：</p>
<p>大标准差，对应的是核中中心元素的权重低于周围元素，即占比低，从而被平滑的越厉害</p>
<p>大尺寸，在标准差不变时，高斯函数值相等，但在归一化后，大尺寸的权重比小尺寸的小，平滑的越厉害</p>
<ul>
<li><p>经验法则: <code>将卷积核的半窗宽度设置为 3𝜎，最终卷积模板尺寸为 2 × 3𝜎 + 1</code></p>
<p>即：只要指定一个参数 $\sigma$ ，就可直接得到窗口大小，从而不用两个参数单独指定</p>
<p>为什么是 $3\sigma$，因为大于该值以后，高斯值为 0，没有意义</p>
</li>
</ul>
<h3 id="高斯核特性说明"><a href="#高斯核特性说明" class="headerlink" title="高斯核特性说明"></a>高斯核特性说明</h3><ul>
<li><p>高斯核是低通滤波器，滤除图像中的高频成分</p>
</li>
<li><p>两个高斯卷积核卷积后得到的还是高斯卷积核</p>
<ul>
<li>使用多次小方差卷积核连续卷积，可以得到与大方差卷积核相同的结果</li>
<li>使用标准差为 $\sigma$ 的高斯核进行两次卷积与使用标准差 $\sqrt 2 \sigma$ 的高斯核进行一次卷积相同</li>
<li>高斯核 1 为 $f$，高斯核 2 为 $g$，两者卷积：</li>
</ul>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">$f$</th>
<th align="center">$g$</th>
<th align="center">$f\star g$</th>
</tr>
</thead>
<tbody><tr>
<td align="center">均值</td>
<td align="center">$m_f$</td>
<td align="center">$m_g$</td>
<td align="center">$m_f + m_g$</td>
</tr>
<tr>
<td align="center">标准差</td>
<td align="center">$\sigma_f$</td>
<td align="center">$\sigma_g$</td>
<td align="center">$\sigma_f + \sigma_g$</td>
</tr>
</tbody></table>
</li>
</ul>
<ul>
<li><p>可分离特性</p>
<ul>
<li><p>大卷积核可分为两个一维高斯的乘积</p>
</li>
<li><p>降低计算复杂度</p>
<p>如 $m \times m$ 的核卷积 $n \times n$ 的图像</p>
<ul>
<li>无分离时，复杂度为：$O(n^2m^2)$</li>
<li>分离后，复杂度为：$O(n^2m)$</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/S5FT1bBny4zXNPa.png" alt="image-20220824105635805" style="zoom: 50%;" />

<h2 id="中值滤波"><a href="#中值滤波" class="headerlink" title="中值滤波"></a>中值滤波</h2><ul>
<li><p>用于去除椒盐噪声、脉冲噪声</p>
</li>
<li><p>使用邻域升序排列的中值作为中心像素的值</p>
</li>
<li><p>中值滤波的灰度值始终是原图像中的灰度值</p>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/LZTwWGEa9iYSXb8.png" alt="image-20220824111807801" style="zoom:67%;" />

<h1 id="卷积与边缘提取"><a href="#卷积与边缘提取" class="headerlink" title="卷积与边缘提取"></a>卷积与边缘提取</h1><h2 id="边缘"><a href="#边缘" class="headerlink" title="边缘"></a>边缘</h2><p>图像中亮度明显而急剧变化的点（灰度不连续）</p>
<h2 id="边缘种类"><a href="#边缘种类" class="headerlink" title="边缘种类"></a>边缘种类</h2><img src="https://s2.loli.net/2022/08/24/OgIo69JtzZV1xBs.png" alt="image-20220824112224033"  />

<h2 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a>边缘检测</h2><ul>
<li>图像中灰度急剧变化的地方，其导数变化明显</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/behGu1jfyNCqEXa.png" alt="image-20220824112556532" style="zoom: 67%;" />

<h3 id="图像求导"><a href="#图像求导" class="headerlink" title="图像求导"></a>图像求导</h3><ul>
<li><p>差分代替一般导数</p>
<p>一般2D函数的偏导为：<br>$$<br>\frac{ \partial f(x,y) }{\partial x} = \lim_{\epsilon \to 0} \frac{f(x+\epsilon) - f(x,y)}{\epsilon}<br>$$</p>
<p>但在数字图像中，$\epsilon$ 不能为0，其最小单位为一个像素，故有：</p>
<p>$$<br>\frac{ \partial f(x,y) }{\partial x} \approx  \frac{f(x+1) - f(x,y)}{1}<br>$$</p>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/i3BgH7fVMKzCFvj.png" alt="image-20220824153549791" style="zoom:67%;" />

<p>X 方向的导数提取了 Y 方向的特征， Y 同理</p>
<h3 id="图像梯度"><a href="#图像梯度" class="headerlink" title="图像梯度"></a>图像梯度</h3><ul>
<li>指向灰度变换最快的方向</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/f7JdjsZrqRTwPuB.png" alt="image-20220824154609791" style="zoom:67%;" />


<ul>
<li>X 方向的梯度与 Y 方向的边缘垂直，其他同理；即梯度方向与边缘垂直。<a href="http://t.csdn.cn/JaDWT" target="_blank" rel="noopener">具体可参考</a></li>
<li>可见，梯度向量与边缘垂直，故也称为边缘法线</li>
<li>梯度幅值的大小衡量了该点处是否是边的可能性的大小，越小，就说明 x 和 y 方向变换不明显，即接近平坦区域</li>
<li>需要对角边缘时，即需要二维核，Robert 算子采用对角性能（详见数字图像处理第四版P516）</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/7wzSxmbYc96Rn4W.png" alt="image-20220824201536126" style="zoom:67%;" />

<p>上述核的功能在于其考虑了周围更多的邻域，减少了噪声的敏感性，以 Soble 算子为例，其可以分解为两个一维核：<br>$$ 
\begin{bmatrix}
1 \\
2 \\
1 
\end{bmatrix}
* 
\begin{bmatrix}
-1 & 0 & 1
\end{bmatrix}
$$ <br>可见，Sobel 是进行了高斯滤波，再进行边缘提取，故受噪声的影响较低。</p>
<p>注意：</p>
<ul>
<li><p>$3 \times 3$ 的核：最小的中心对称核，考虑了中心对侧数据的性质</p>
</li>
<li><p>Soble 算子能够更好的平滑噪声</p>
</li>
<li><p>上图中所有的算子，权重和为 0，即在恒定灰度区域的响应为 0 （恒定区域灰度值相等，与核相乘相加为0）</p>
</li>
<li><p>梯度幅值的实现</p>
<p>实际中，使用平方及平方根的开销大，一般使用绝对值近似<br>$$<br>M(x,y) \approx |{g_x}| + |g_y|<br>$$</p>
</li>
</ul>
<p>​      虽计算简单，但使得滤波器不再具有各向同性（即旋转不变性）</p>
<h3 id="实际情况"><a href="#实际情况" class="headerlink" title="实际情况"></a>实际情况</h3><p>但实际中，由于噪声的影响，求导的结果也无法得出边缘的位置</p>
<img src="https://s2.loli.net/2022/08/24/jEVMa2lo1QTYChb.png" alt="image-20220824155924396" style="zoom:67%;" />

<p>因而在求导前先平滑滤波处理</p>
<img src="https://s2.loli.net/2022/08/24/3owgdve78JiRTkr.png" alt="image-20220824160238988" style="zoom: 80%;" />

<p>由于微分求导也是卷积，卷积具有结合性，故原图的高斯卷积与可求导结合（高斯一阶偏导核），最后和原图卷积，从而可节省一次卷积操作</p>
<img src="https://s2.loli.net/2022/08/24/xOUgdR14sWHZyKG.png" alt="image-20220824160432968" style="zoom: 80%;" />

<h3 id="高斯一阶偏导核"><a href="#高斯一阶偏导核" class="headerlink" title="高斯一阶偏导核"></a>高斯一阶偏导核</h3><img src="https://s2.loli.net/2022/08/24/u6M2oehGtqyzcU5.png" alt="image-20220824162121661" style="zoom: 80%;" />

<ul>
<li>高斯与一阶偏导的对比<ul>
<li>高斯核<ul>
<li>消除高频成分（低通滤波器）</li>
<li>卷积核中的权值不可为负数（倒扣钟型）</li>
<li>权值总和为1（恒定区域不受卷积影响）</li>
</ul>
</li>
<li>高斯一阶偏导核<ul>
<li>高斯的导数</li>
<li>卷积核中的权值可以为负</li>
<li>权值总和是0（恒定区域无响应，急剧变化的地方响应大）</li>
<li>高对比度点的响应值大</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Canny-检测算子"><a href="#Canny-检测算子" class="headerlink" title="Canny 检测算子"></a>Canny 检测算子</h3><img src="https://s2.loli.net/2022/08/24/YOA5VQ82f9c74Mr.png" alt="image-20220824210414089" style="zoom:80%;" />

<p>​    经过两个方向上高斯一阶导，得到梯度幅值图，可见，边缘较宽，这是因为在灰度斜坡上一阶导不为 0，如何得到更为准确的边缘？</p>
<ul>
<li><p>非极大值抑制</p>
<ul>
<li>实质是规定梯度方向（边缘法线）的多个离散方向，如定义为水平、垂直、+45°、-45° 四个方向（一条边缘有正负两条边缘法线），即所有可能得边缘量化为这四个方向，但显然，边缘法线方向可能是任意的，故需要定义某个范围，落在该范围内就认为是哪个方向，该定义方式如下图所示（详见数字图像数字图像处理第四版 P526）</li>
</ul>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/AzSD6XU5p4Vacyo.png" alt="image-20220824212916034" style="zoom: 80%;" />

<ul>
<li><p>流程：</p>
<ul>
<li><p>对任意一点，求该点的梯度幅值 $K$ 和方向 $\alpha$</p>
</li>
<li><p>在四种边缘法线中找到最接近梯度方向 $\alpha$ 的，记为 $d_k$</p>
</li>
<li><p>在  $d_k$ 方向上取一个或两个邻点，若 $K$ 小于所取点的梯度幅值，则令 $g_N(x,y) = 0$ （即抑制），否则为 $g_N(x,y) = K$）（$g_N(x,y)$ 为非极大值抑制后的图像）</p>
</li>
</ul>
</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/9b4tNFxhn6AfWTm.png" alt="image-20220824210836545" style="zoom: 67%;" />

<ul>
<li><p>双阈值法</p>
<ul>
<li>阈值过高导致细节丢失，过低则边缘杂乱</li>
</ul>
<img src="https://s2.loli.net/2022/08/24/2wQXCbSgkaihLAp.png" alt="image-20220824211107517" style="zoom: 67%;" />

<ul>
<li><p>双阈值：先利用高阈值筛选出主要的边缘，再利用低阈值将这些边缘连接起来（低阈值虽然会引入噪声引起的假边，但是这种假边不会和高阈值筛选出的主要边缘有连接）</p>
<img src="https://s2.loli.net/2022/08/24/vPNtdZhnIjlBXi3.png" alt="image-20220824211258649" style="zoom:80%;" />
</li>
</ul>
</li>
<li><p>Canny 整体流程：</p>
<ol>
<li>用高斯一阶偏导核卷积图像</li>
<li>计算每个点的梯度幅值和方向</li>
<li>非极大值抑制：<ul>
<li>将宽的“边缘”细化至单个像素宽度</li>
</ul>
</li>
<li>连接与阈值（滞后）：<ul>
<li>定义两个阈值：低和高</li>
<li>使用高阈值开始边缘曲线，使用低阈值继续边缘曲线</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1 id="拟合"><a href="#拟合" class="headerlink" title="拟合"></a>拟合</h1><h2 id="引例"><a href="#引例" class="headerlink" title="引例"></a>引例</h2><p>在获得边缘后，接下来的问题是，对于图中的特征如何进行描述，即选择参数模型进行拟合，但实际中，面临三个问题：</p>
<ul>
<li>噪声</li>
<li>局外点的影响</li>
<li>遮挡导致的数据丢失</li>
</ul>
<p>为此，针对不同的情况需要不同的方法</p>
<ul>
<li>如若知道所有点都属于一条直线，该如何找到这条最优直线？<ul>
<li>最小二乘</li>
</ul>
</li>
<li>若存在外点呢？<ul>
<li>RANSAC</li>
</ul>
</li>
<li>若这些点属于多条直线呢？<ul>
<li>投票机制：RANSAC、Hough 变换</li>
</ul>
</li>
<li>更一般的情况，不确定其是否是直线？<ul>
<li>模型筛选</li>
</ul>
</li>
</ul>
<h2 id="最小二乘"><a href="#最小二乘" class="headerlink" title="最小二乘"></a>最小二乘</h2><h3 id="“垂直”最小二乘"><a href="#“垂直”最小二乘" class="headerlink" title="“垂直”最小二乘"></a>“垂直”最小二乘</h3><p>如图，对于 $n$ 个点，若其直线方程为 $y = mx + b$ ，则要使每个点到该直线的垂直距离最小化，方可说明这些点在该直线上</p>
<p>于是，可建立能量函数（目标函数），并使其最小化：<br>$$<br>E=\sum_{i=1}^n (y_i -mx_i -b)^2<br>$$<br>这里之所以取平方，是因为我们只关心点到直线的距离，不关心正负。</p>
<p>对 $n$ 个点，有<br>$$<br>\begin{cases}<br>y_1 = mx_1 + b \\<br>y_2 = mx_2 + b \\<br>\vdots \\<br>y_n = mx_n + b<br>\end{cases}<br>$$<br>写成矩阵形式：<br>$$<br>Y = XB<br>$$</p>
<p>$$ 
Y=\begin{bmatrix}
y_1 \\
y_2 \\
\vdots \\
y_n
\end{bmatrix}

\qquad
X=\begin{bmatrix}
x_1 & 1\\
x_2 & 1\\
\vdots & \vdots \\
x_n & 1
\end{bmatrix}

\qquad
B=\begin{bmatrix}
m \\
b \\
\end{bmatrix}
$$ <br>到此，前述的能量函数变为（平方和即为模）：<br>$$<br>E = ||Y-XB||^2<br>$$<br>$B$ 为待求项，$||X||$ 为向量的模，是内部元素的平方和开根号，这也是能量函数取平方的另一个好处。对一个向量 $A = \begin{bmatrix} a_1\\ a_2 \\a_3 \end{bmatrix} $，有：<br>$$<br>||A|| ^2 = a_1^2 +a_2^2 + a_3^2 = A^TA<br>$$<br>故能量函数可写为：<br>$$ 
\begin{align}
E  & = ||Y-XB||^2 =  (Y-XB)^T(Y-XB) \\ & \overset{展开}{=}  (Y^T-B^TX^T)(Y-XB) \\ & = Y^TY - Y^TXB-B^TX^TY + B^TX^TXB  \\ & = Y^TY-2(XB)^TY+(XB)^TXB
\end{align}
$$ <br>为求 $B$，自然想到让 $E$ 对 $B$ 求导：<br>$$<br>\frac{dE}{dB} = -2X^TY + 2X^TXB = 0<br>$$<br>从而求得：<br>$$<br>B = (X^TX)^{-1}X^TY<br>$$<br><img src="https://s2.loli.net/2022/08/27/D6S5ErMeb4oNcHG.png" alt="image-20220827212852424" style="zoom: 80%;" /></p>
<p>问题：</p>
<ul>
<li>当直线垂直 x 轴时，方法失效</li>
<li>即不满足旋转不变性，直线转动到垂直时无法求解</li>
</ul>
<h3 id="全最小二乘"><a href="#全最小二乘" class="headerlink" title="全最小二乘"></a>全最小二乘</h3><ul>
<li><p>目的：解决垂直最小二乘的失效情况</p>
</li>
<li><p>原理</p>
</li>
</ul>
<p>假设一点$(x_i,y_i)$ 和一直线 $ax+by=d$ （满足 $a^2+b^2=1$)，则该点到该直线的距离为<br>$$<br>|ax_i+by_i-d|<br>$$<br>要拟合直线，即找到合适的 $(a,b,d)$ 使得所有的点到该直线的距离最小，即最小化能量函数：<br>$$ 
E=\sum^n_{i=1}(ax_i+by_i-d)^2 \tag{*}
$$ <br>该函数对 $d$ 求导可得：<br>$$<br>\frac{\partial E}{\partial d} = \sum^n_{i=1} -2(ax_i+by_i-d) =0<br>$$<br>整理得：<br>$$ 
d = \frac{a}{n}\sum^n_{i=1} x_i + \frac{b}{n}\sum^n_{i=1} y_i = a\bar{x} + b\bar{y} \tag{**}
$$ <br>将其代入 (*) 式可得：<br>$$ 
E=\sum^n_{i=1}(a(x_i-\bar{x}) + b(y_i-\bar{y}))^2 = 
||
\begin{bmatrix} x_1 - \bar{x} & y_1 - \bar{y} \\
\vdots & \vdots \\
x_n - \bar{x} & y_n - \bar{y}
\end{bmatrix}
\begin{bmatrix}
a \\
b
\end{bmatrix}
||^2
= (UN)^T(UN)
$$ <br>为求得 N，可求导：<br>$$<br>\frac{dE}{dN}=2(U^TU)N= (U^TU)N =0<br>$$<br>根据特征值与特征向量的关系，对 $AN=\lambda N$，要使其为 0，只能是 $\lambda = 0$，故该方程的解为最小特征值对应的特征向量</p>
<img src="https://s2.loli.net/2022/10/02/67STchKG9yEmrlR.png" alt="image-20221002200507340" style="zoom:80%;" />

<p>事实上，上述的 $U^TU$ 矩阵为二阶矩矩阵，如下图，由前述(**)式可知点 $(\bar{x},\bar{y})$ 在该直线上，从几何角度来看，使得能量方程最小化的点即为使得任意点与该点的向量在该直线的法线上的分量最小。</p>
<img src="https://s2.loli.net/2022/10/02/myKu2oC3rQwZaf5.png" alt="image-20221002205336633" style="zoom:80%;" />

<h3 id="鲁棒估计（鲁棒核函数）"><a href="#鲁棒估计（鲁棒核函数）" class="headerlink" title="鲁棒估计（鲁棒核函数）"></a>鲁棒估计（鲁棒核函数）</h3><p>如图是最小二乘拟合的结果，可见，当出现外点（即噪声）的影响时，拟合的准确性很差</p>
<img src="https://s2.loli.net/2022/10/02/syfARnZaT49d1Gp.png" alt="image-20221002211040260" style="zoom:80%;" />

<p>这是因为最小二乘要确保所有的点都使得能量函数最小化，所以直线朝着外点倾斜，外点距离真实直线的距离很远，拟合时所占的比重很大，为缩小这种外点的比重，引入了鲁棒估计</p>
<img src="https://s2.loli.net/2022/10/02/yJojHPL1dY5aISw.png" alt="image-20221002211109257" style="zoom:80%;" />

<p>鲁棒估计引入鲁棒核函数 $\rho$ ，该函数有一个缩放因子参数 $\sigma$，通过该值可调整权重，其和距离类似，不同的是，当距离超过一定限度时，该值不再增加。以图中 $\sigma = 0.1$ 为例，当横坐标值大于 4 时，值都为1。换句话说，对一点而言，不论该点距离直线的距离是1k还是1w，对能量函数而言其比重都为 4，这样就在一定程度上避免了外点占比过大，导致拟合精度差的问题。</p>
<p>缩放因子参数 $\sigma$ 选取不同的拟合结果：</p>
<center>
<figure>
    <img src="https://s2.loli.net/2022/10/02/WpDQRw1NhVK6xdT.png" style="zoom:28%"/>
    <img src="https://s2.loli.net/2022/10/02/ZoJ62HKhO8TRGwY.png" style="zoom:27%"/>
    <img src="https://s2.loli.net/2022/10/02/p7ZGkib5mg1WABy.png" style="zoom:28%"/>
    <br>合适
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
   过小
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
  过大
    </figure>
</center>



<h2 id="RANSAC"><a href="#RANSAC" class="headerlink" title="RANSAC"></a>RANSAC</h2><h1 id="角点检测"><a href="#角点检测" class="headerlink" title="角点检测"></a>角点检测</h1><p>为何提取需要提取特征？多视角拼接</p>
<h2 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h2><ul>
<li>特征的要求<ul>
<li>可重复性：即使有几何变换等的影响，该特征仍能在多视角中找到</li>
<li>独特性：每个特征应当是独特的，否则难以匹配</li>
<li>高效性：考虑计算的高效性</li>
<li>局部性：特征只是局部的</li>
</ul>
</li>
</ul>
<h2 id="角点"><a href="#角点" class="headerlink" title="角点"></a>角点</h2><ul>
<li>只有角点在各个方向移动时窗口内灰度变化大 </li>
</ul>
<img src="https://s2.loli.net/2022/08/25/eiV97TIfXFthGkl.png" alt="image-20220825113340724" style="zoom:80%;" />

<h2 id="Harris角点检测"><a href="#Harris角点检测" class="headerlink" title="Harris角点检测"></a>Harris角点检测</h2><img src="https://s2.loli.net/2022/08/25/5lLc21vCWtVA8hG.png" alt="image-20220825121708179" style="zoom:80%;" />

<h3 id="不变性分析"><a href="#不变性分析" class="headerlink" title="不变性分析"></a>不变性分析</h3><ul>
<li>灰度仿射变换<ul>
<li>仅灰度是具有不变性的，对同一点，增加其灰度和减小其灰度，求导后其趋势不变</li>
<li>但灰度缩放导致部分点超过阈值，缩放前后不满足不变性，</li>
<li>即灰度仿射变换满足部分不变性</li>
</ul>
</li>
<li>图像平移变换满足不变性</li>
<li>图像旋转变换满足协变性</li>
<li>不满足尺度不变性</li>
</ul>
<h2 id="斑点（Blob）检测"><a href="#斑点（Blob）检测" class="headerlink" title="斑点（Blob）检测"></a>斑点（Blob）检测</h2><ul>
<li>高斯二阶导<ul>
<li>同一信号，不同的 $\sigma$ 产生不同的相应，适当的模板会产生极大值（尺度归一化），实现多尺度检测</li>
<li>尺度空间中，只比较上下两个相邻的尺度空间，比较相邻27个点，进行非最大化抑制</li>
</ul>
</li>
<li>改进<ul>
<li>Harris-Lap</li>
<li>SIFT</li>
</ul>
</li>
</ul>
<h3 id="尺度不变性特征检测"><a href="#尺度不变性特征检测" class="headerlink" title="尺度不变性特征检测"></a>尺度不变性特征检测</h3><ul>
<li><p>DOG：高斯差分近似拉普拉斯</p>
</li>
<li><p>利用高斯核的可分离性</p>
</li>
</ul>
<ul>
<li></li>
</ul>
<h1 id="空间滤波"><a href="#空间滤波" class="headerlink" title="空间滤波"></a>空间滤波</h1><h2 id="空间相关与卷积"><a href="#空间相关与卷积" class="headerlink" title="空间相关与卷积"></a>空间相关与卷积</h2><ul>
<li><p>相关：图像上移动核的中心，求每个位置的乘积之和</p>
<ul>
<li>只满足分配律</li>
</ul>
</li>
<li><p>卷积：把相关运算的<code>核旋转180°</code></p>
<ul>
<li>线性：F(f1+f2) = F(f1)+F(f2)</li>
<li>平移不变形：F(S(f)) = S(F(f))</li>
<li>满足线性平移不变性的操作均可定义为卷积</li>
<li>满足交换律、结合律、分配律</li>
</ul>
</li>
<li><p>卷积时边缘的处理：边界填充</p>
<ul>
<li>卷积核的特性导致卷积后的图像和原图不一样大</li>
<li>零填充</li>
<li>复制边缘</li>
<li>镜像边缘</li>
</ul>
</li>
<li><p>可分离核</p>
<ul>
<li>可分离核：能够表示为两个向量外积的矩阵</li>
<li>$m \times n$ 的核 $\text{w}$ 可分离为：$\text{w} = v_{m \times 1}w_{n \times 1}^T$</li>
<li>$m \times m$ 的核  $\text{w}$ 可分离为：$\text{w} = v_{m \times 1}v_{m \times 1}^T$</li>
<li>优势：减少计算量，大核分离为小核计算</li>
<li>判断是否可分离：矩阵的秩为 1（矩阵论：一列向量与一行向量的乘积的矩阵，秩为 1）</li>
</ul>
</li>
<li><h2 id="空间滤波器的构建"><a href="#空间滤波器的构建" class="headerlink" title="空间滤波器的构建"></a>空间滤波器的构建</h2></li>
</ul>

          
            <br>
            
  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=https://hbroad.github.io/2022/07/17/digital_image_process/>https://hbroad.github.io/2022/07/17/digital_image_process/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  


          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2022-10-02T22:28:26+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2022年10月2日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/DIP/" rel="nofollow"><i class="fas fa-hashtag fas fa-tags" aria-hidden="true"></i><p>DIP</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://hbroad.github.io/2022/07/17/digital_image_process/&title=数字图像处理 - 南阳向北&summary=数字图像处理基础理论（待补充）
(通俗易懂的计算机视觉优质课程)北京邮电大学计算机学院-鲁鹏
（文中所有图片均摘自该课程）"
          
          >
          
            <img src="https://s2.loli.net/2022/08/02/HQ2vMiA6BOg8Vum.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://hbroad.github.io/2022/07/17/digital_image_process/&title=数字图像处理 - 南阳向北&summary=数字图像处理基础理论（待补充）
(通俗易懂的计算机视觉优质课程)北京邮电大学计算机学院-鲁鹏
（文中所有图片均摘自该课程）"
          
          >
          
            <img src="https://s2.loli.net/2022/08/02/Jrfx7ZhuA6LmIOT.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://hbroad.github.io/2022/07/17/digital_image_process/&title=数字图像处理 - 南阳向北&summary=数字图像处理基础理论（待补充）
(通俗易懂的计算机视觉优质课程)北京邮电大学计算机学院-鲁鹏
（文中所有图片均摘自该课程）"
          
          >
          
            <img src="https://s2.loli.net/2022/08/02/1bqKo4MSClXNeGY.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2022/07/29/data_structure/'>
              <h6><i class="fas fa-chevron-left" aria-hidden="true"></i> 上一页</h6>
                <p class='title'>数据结构</p>
                <!--
                <p class='content'>数据结构理论
宝藏级+保姆级课程-数据结构与算法基础-青岛大学-王卓老师


时间复杂度时间复杂度：各条指令执行的时间之和
大O表示法
表示算法执行的渐进上限
性质：
任意常数 $c &gt;0...</p>
                -->
              </a>
            
            
              <a class='next' href='/2022/07/17/point_cloud_pcl/'>
               <h6>下一页 <i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                <p class='title'>点云+PCL学习笔记</p>
                <!--
                <p class='content'>研究生阶段开始学习的一些笔记，存储在本地，为方便查看，现搬至博客
（注：部分图片未上传至图床，抽空补充）


点云
分布在 N 维空间中的离散点集

是对物体表面信息的离散采样


点云库
三维...</p>
                -->
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments blur">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-spinner fa-spin fa-fw"></i>
          </div>
        </section>
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: true,
    tags: "ams",
    macros: {
      href: "{}"
    }
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore|dno",
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
};
</script>




  <script>
    window.subData = {
      title: '数字图像处理',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  
    
    


  <section class="widget toc-wrapper blur desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#常见噪声"><span class="toc-text">常见噪声</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#卷积"><span class="toc-text">卷积</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高斯卷积"><span class="toc-text">高斯卷积</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#高斯卷积的生成"><span class="toc-text">高斯卷积的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数的选取"><span class="toc-text">参数的选取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高斯核特性说明"><span class="toc-text">高斯核特性说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#中值滤波"><span class="toc-text">中值滤波</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#边缘"><span class="toc-text">边缘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#边缘种类"><span class="toc-text">边缘种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#边缘检测"><span class="toc-text">边缘检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#图像求导"><span class="toc-text">图像求导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图像梯度"><span class="toc-text">图像梯度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实际情况"><span class="toc-text">实际情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高斯一阶偏导核"><span class="toc-text">高斯一阶偏导核</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canny-检测算子"><span class="toc-text">Canny 检测算子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引例"><span class="toc-text">引例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最小二乘"><span class="toc-text">最小二乘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#“垂直”最小二乘"><span class="toc-text">“垂直”最小二乘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全最小二乘"><span class="toc-text">全最小二乘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#鲁棒估计（鲁棒核函数）"><span class="toc-text">鲁棒估计（鲁棒核函数）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RANSAC"><span class="toc-text">RANSAC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特征提取"><span class="toc-text">特征提取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#角点"><span class="toc-text">角点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Harris角点检测"><span class="toc-text">Harris角点检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#不变性分析"><span class="toc-text">不变性分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#斑点（Blob）检测"><span class="toc-text">斑点（Blob）检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#尺度不变性特征检测"><span class="toc-text">尺度不变性特征检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空间相关与卷积"><span class="toc-text">空间相关与卷积</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空间滤波器的构建"><span class="toc-text">空间滤波器的构建</span></a></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class='copyright'>
        <p>Copyright © 2018-2022  南阳向北</p>

        </div>
      
    

<script>setLoadingBarProgress(80);</script>

<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("04/02/2020 09:00:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>

  </footer>



      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://s2.loli.net/2022/08/02/vifdEe4nStHyhgu.jpg", "https://s2.loli.net/2022/08/02/nEDS58psx7A3RcB.jpg", "https://s2.loli.net/2022/08/02/go8X2k4P5tjKqws.jpg", "https://s2.loli.net/2022/08/22/LBbUTqHAXFEZGjD.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  








  
    
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.4.0/js/valine.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var guest_info = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var notify = 'true' == 'true';
  var verify = 'true' == 'true';
  var valine = new Valine();
  valine.init({
    el: '#valine_container',
    notify: notify,
    verify: verify,
    guest_info: guest_info,
    
    appId: "D08WOirJLYeYsVbBUOfdWPpf-gzGzoHsz",
    appKey: "fnC4nL5p8dhLXMMTpu8jXX8O",
    placeholder: "说点什么吧~",
    pageSize:'10',
    avatar:'identicon',
    lang:'zh-cn',
    visitor: 'true',
    highlight:'true'
  })
  </script>



  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.4/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-clipboard-check');
        let $span = $($btn.find('span'));
        $span[0].innerText = '复制成功';
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-exclamation-triangle');
        let $span = $($btn.find('span'));
        $span[0].innerText = '复制失败';
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>



<!--点击烟花爆炸效果-->
<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="/js/fireworks.js"></script>


